---
###############################################################################
# Annotate User Configuration
###############################################################################
# Sanitize (standardize with default values if not set) NZBGet configuration.
#
# Use r_pufky.data.v3 data annotations to enforce consistency and validation
# checks.
#
# Generates:
#   _nzbget_map: list of dict - Annotated config map.
#   _nzbget_order: list of str - Config section order.
#
# Reference:
# * https://nzbget.com

- name: 'Annotate | sanitize & annotate service defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _nzbget_srv_scripts_source: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_scripts_source,
        default='',
        _src=nzbget_srv_scripts_source | regex_replace('\\/$', '') ~ '/',
        hint='str',
        order=1
        )
      }}"
    _nzbget_srv_auto_add_apt_sources_enable: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_auto_add_apt_sources_enable,
        default=true,
        hint='bool',
        order=2
        )
      }}"
    _nzbget_srv_user: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_user,
        default='media',
        _uid='',
        hint='str',
        order=3
        )
      }}"
    _nzbget_srv_group: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_group,
        default='media',
        _gid='',
        hint='bool',
        order=4
        )
      }}"
    _nzbget_srv_create_user: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_create_user,
        default=true,
        hint='bool',
        order=5
        )
      }}"
    _nzbget_srv_user_data_manage_enable: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_user_data_manage_enable,
        default=false,
        hint='bool',
        order=6
        )
      }}"
    _nzbget_srv_media_perms_folder: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_media_perms_folder,
        default='2755',
        hint='str',
        order=7
        )
      }}"
    _nzbget_srv_media_set_perms_file_enable: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_media_set_perms_file_enable,
        default=false,
        hint='bool',
        order=8
        )
      }}"
    _nzbget_srv_media_perms_file: "{{ {} | r_pufky.data.v3(
        raw=nzbget_srv_media_perms_file,
        default='0644',
        hint='str',
        order=9
        )
      }}"

- name: 'Annotate | sanitize & annotate config defaults'
  ansible.builtin.set_fact:  # noqa jinja[spacing] readability.
    _nzbget_cfg_main_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='MainDir',
        raw=nzbget_cfg_main_dir,
        default='/var/lib/nzbget',
        hint='str',
        order=1
        )
      }}"
    _nzbget_cfg_dest_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='DestDir',
        raw=nzbget_cfg_dest_dir,
        default='/data/downloads/completed',
        hint='str',
        order=2
        )
      }}"
    _nzbget_cfg_inter_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='InterDir',
        raw=nzbget_cfg_inter_dir,
        default='/var/lib/nzbget/downloads/intermediate',
        hint='str',
        order=3
        )
      }}"
    _nzbget_cfg_nzb_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='NzbDir',
        raw=nzbget_cfg_nzb_dir,
        default='/var/lib/nzbget/downloads/nzb',
        hint='str',
        order=4
        )
      }}"
    _nzbget_cfg_queue_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='QueueDir',
        raw=nzbget_cfg_queue_dir,
        default='/var/lib/nzbget/downloads/queue',
        hint='str',
        order=5
        )
      }}"
    _nzbget_cfg_temp_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='TempDir',
        raw=nzbget_cfg_temp_dir,
        default='/var/lib/nzbget/tmp',
        hint='str',
        order=6
        )
      }}"
    _nzbget_cfg_web_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='WebDir',
        raw=nzbget_cfg_web_dir,
        default='/usr/share/nzbget/webui',
        hint='str',
        order=7
        )
      }}"
    _nzbget_cfg_script_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='ScriptDir',
        raw=nzbget_cfg_script_dir,
        default='/var/lib/nzbget/scripts',
        hint='str',
        order=8
        )
      }}"
    _nzbget_cfg_lock_file: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='LockFile',
        raw=nzbget_cfg_lock_file,
        default='/var/lib/nzbget/downloads/nzbget.lock',
        _file=nzbget_cfg_lock_file | basename,
        _dest=nzbget_cfg_lock_file | dirname,
        hint='str',
        order=9
        )
      }}"
    _nzbget_cfg_log_file: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='LogFile',
        raw=nzbget_cfg_log_file,
        default='/var/lib/nzbget/downloads/nzbget.log',
        _file=nzbget_cfg_log_file | basename,
        _dest=nzbget_cfg_log_file | dirname,
        hint='str',
        order=10
        )
      }}"
    _nzbget_cfg_config_template: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='ConfigTemplate',
        raw=nzbget_cfg_config_template,
        default='/usr/share/nzbget/nzbget.conf',
        _file=nzbget_cfg_config_template | basename,
        _dest=nzbget_cfg_config_template | dirname,
        hint='str',
        order=11
        )
      }}"
    _nzbget_cfg_required_dir: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='RequiredDir',
        raw=nzbget_cfg_required_dir,
        data=nzbget_cfg_required_dir | join(','),
        default=[],
        hint='list of str',
        order=12
        )
      }}"
    _nzbget_cfg_cert_store: "{{ {} | r_pufky.data.v3(
        section='Paths',
        key='CertStore',
        raw=nzbget_cfg_cert_store,
        _file=nzbget_cfg_cert_store | basename,
        _dest=nzbget_cfg_cert_store | dirname,
        hint='str',
        order=13
        )
      }}"
    _nzbget_cfg_news_servers: "{{ {} | r_pufky.data.v3(
        section='News Servers',
        key='Server',
        raw=nzbget_cfg_news_servers,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _nzbget_cfg_control_ip: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='ControlIP',
        raw=nzbget_cfg_control_ip,
        default='0.0.0.0',
        hint='str',
        order=1
        )
      }}"
    _nzbget_cfg_control_port: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='ControlPort',
        raw=nzbget_cfg_control_port,
        default=6789,
        hint='int',
        order=2
        )
      }}"
    _nzbget_cfg_control_username: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='ControlUsername',
        raw=nzbget_cfg_control_username,
        default='nzbget',
        hint='str',
        sensitive=true,
        order=3
        )
      }}"
    _nzbget_cfg_control_password: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='ControlPassword',
        raw=nzbget_cfg_control_password,
        default='tegbzn6789',
        hint='str',
        sensitive=true,
        order=4
        )
      }}"
    _nzbget_cfg_restricted_username: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='RestrictedUsername',
        raw=nzbget_cfg_restricted_username,
        default='',
        hint='str',
        sensitive=true,
        order=5
        )
      }}"
    _nzbget_cfg_restricted_password: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='RestrictedPassword',
        raw=nzbget_cfg_restricted_password,
        default='',
        hint='str',
        order=6
        )
      }}"
    _nzbget_cfg_add_username: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='AddUsername',
        raw=nzbget_cfg_add_username,
        default='',
        hint='str',
        sensitive=true,
        order=7
        )
      }}"
    _nzbget_cfg_add_password: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='AddPassword',
        raw=nzbget_cfg_add_password,
        default='',
        hint='str',
        sensitive=true,
        order=8
        )
      }}"
    _nzbget_cfg_form_auth: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='FormAuth',
        raw=nzbget_cfg_form_auth,
        default=false,
        hint='bool',
        order=9
        )
      }}"
    _nzbget_cfg_secure_control: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='SecureControl',
        raw=nzbget_cfg_secure_control,
        default='',
        hint='bool',
        order=10
        )
      }}"
    _nzbget_cfg_secure_port: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='SecurePort',
        raw=nzbget_cfg_secure_port,
        default=6791,
        hint='int',
        order=11
        )
      }}"
    _nzbget_cfg_secure_cert: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='SecureCert',
        raw=nzbget_cfg_secure_cert,
        default='',
        hint='str',
        order=12
        )
      }}"
    _nzbget_cfg_secure_key: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='SecureKey',
        raw=nzbget_cfg_secure_key,
        default='',
        hint='str',
        order=13
        )
      }}"
    _nzbget_cfg_authorized_ip: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='AuthorizedIP',
        raw=nzbget_cfg_authorized_ip,
        data=nzbget_cfg_authorized_ip | join(','),
        default=['127.0.0.1'],
        hint='list of str',
        order=14
        )
      }}"
    _nzbget_cfg_cert_check: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='CertCheck',
        raw=nzbget_cfg_cert_check,
        default=true,
        hint='bool',
        order=15
        )
      }}"
    _nzbget_cfg_update_check: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='UpdateCheck',
        raw=nzbget_cfg_update_check,
        default='none',
        hint='str',
        order=16
        )
      }}"
    _nzbget_cfg_daemon_username: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='DaemonUsername',
        raw=nzbget_cfg_daemon_username,
        default='root',
        hint='str',
        order=17
        )
      }}"
    _nzbget_cfg_u_mask: "{{ {} | r_pufky.data.v3(
        section='Security',
        key='UMask',
        raw=nzbget_cfg_u_mask,
        default='0002',
        hint='str',
        order=18
        )
      }}"
    _nzbget_cfg_categories: "{{ {} | r_pufky.data.v3(
        section='Categories',
        key='Category',
        raw=nzbget_cfg_categories,
        data=[],
        default=[{'id': 1, 'name': 'Movies'},
                 {'id': 2, 'name': 'Series'},
                 {'id': 3, 'name': 'Music'},
                 {'id': 4, 'name': 'Software'}],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _nzbget_cfg_rss_feeds: "{{ {} | r_pufky.data.v3(
        section='RSS Feeds',
        key='Feed',
        raw=nzbget_cfg_rss_feeds,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _nzbget_cfg_append_category_dir: "{{ {} | r_pufky.data.v3(
        section='Incoming NZBs',
        key='AppendCategoryDir',
        raw=nzbget_cfg_append_category_dir,
        default=true,
        hint='bool',
        order=1
        )
      }}"
    _nzbget_cfg_nzb_dir_interval: "{{ {} | r_pufky.data.v3(
        section='Incoming NZBs',
        key='NzbDirInterval',
        raw=nzbget_cfg_nzb_dir_interval,
        default=5,
        hint='int',
        order=2
        )
      }}"
    _nzbget_cfg_nzb_dir_file_age: "{{ {} | r_pufky.data.v3(
        section='Incoming NZBs',
        key='NzbDirFileAge',
        raw=nzbget_cfg_nzb_dir_file_age,
        default=60,
        hint='int',
        order=3
        )
      }}"
    _nzbget_cfg_dupe_check: "{{ {} | r_pufky.data.v3(
        section='Incoming NZBs',
        key='DupeCheck',
        raw=nzbget_cfg_dupe_check,
        default=true,
        hint='bool',
        order=4
        )
      }}"
    _nzbget_cfg_flush_queue: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='FlushQueue',
        raw=nzbget_cfg_flush_queue,
        default=true,
        hint='bool',
        order=1
        )
      }}"
    _nzbget_cfg_continue_partial: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='ContinuePartial',
        raw=nzbget_cfg_continue_partial,
        default=true,
        hint='bool',
        order=2
        )
      }}"
    _nzbget_cfg_propagation_delay: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='PropagationDelay',
        raw=nzbget_cfg_propagation_delay,
        default=0,
        hint='int',
        order=3
        )
      }}"
    _nzbget_cfg_article_cache: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='ArticleCache',
        raw=nzbget_cfg_article_cache,
        default=100,
        hint='int',
        order=4
        )
      }}"
    _nzbget_cfg_direct_write: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='DirectWrite',
        raw=nzbget_cfg_direct_write,
        default=true,
        hint='bool',
        order=5
        )
      }}"
    _nzbget_cfg_write_buffer: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='WriteBuffer',
        raw=nzbget_cfg_write_buffer,
        default=1024,
        hint='int',
        order=6
        )
      }}"
    _nzbget_cfg_file_naming: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='FileNaming',
        raw=nzbget_cfg_file_naming,
        default='auto',
        hint='str',
        order=7
        )
      }}"
    _nzbget_cfg_rename_after_unpack: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='RenameAfterUnpack',
        raw=nzbget_cfg_rename_after_unpack,
        default=true,
        hint='bool',
        order=8
        )
      }}"
    _nzbget_cfg_rename_ignore_ext: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='RenameIgnoreExt',
        raw=nzbget_cfg_rename_ignore_ext,
        data=nzbget_cfg_rename_ignore_ext | join(','),
        default=['.zip', '.7z', '.rar', '.par2'],
        hint='list of str',
        order=9
        )
      }}"
    _nzbget_cfg_reorder_files: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='ReorderFiles',
        raw=nzbget_cfg_reorder_files,
        default=true,
        hint='bool',
        order=10
        )
      }}"
    _nzbget_cfg_post_strategy: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='PostStrategy',
        raw=nzbget_cfg_post_strategy,
        default='balanced',
        hint='str',
        order=11
        )
      }}"
    _nzbget_cfg_disk_space: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='DiskSpace',
        raw=nzbget_cfg_disk_space,
        default=250,
        hint='int',
        order=12
        )
      }}"
    _nzbget_cfg_nzb_cleanup_disk: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='NzbCleanupDisk',
        raw=nzbget_cfg_nzb_cleanup_disk,
        default=true,
        hint='bool',
        order=13
        )
      }}"
    _nzbget_cfg_keep_history: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='KeepHistory',
        raw=nzbget_cfg_keep_history,
        default=30,
        hint='int',
        order=14
        )
      }}"
    _nzbget_cfg_feed_history: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='FeedHistory',
        raw=nzbget_cfg_feed_history,
        default=7,
        hint='int',
        order=15
        )
      }}"
    _nzbget_cfg_skip_write: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='SkipWrite',
        raw=nzbget_cfg_skip_write,
        default=false,
        hint='bool',
        order=16
        )
      }}"
    _nzbget_cfg_raw_article: "{{ {} | r_pufky.data.v3(
        section='Download Queue',
        key='RawArticle',
        raw=nzbget_cfg_raw_article,
        default=false,
        hint='bool',
        order=17
        )
      }}"
    _nzbget_cfg_article_retries: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='ArticleRetries',
        raw=nzbget_cfg_article_retries,
        default=3,
        hint='int',
        order=1
        )
      }}"
    _nzbget_cfg_article_interval: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='ArticleInterval',
        raw=nzbget_cfg_article_interval,
        default=10,
        hint='int',
        order=2
        )
      }}"
    _nzbget_cfg_article_timeout: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='ArticleTimeout',
        raw=nzbget_cfg_article_timeout,
        default=60,
        hint='int',
        order=3
        )
      }}"
    _nzbget_cfg_article_read_chunk_size: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='ArticleReadChunkSize',
        raw=nzbget_cfg_article_read_chunk_size,
        default=4,
        hint='int',
        order=4
        )
      }}"
    _nzbget_cfg_url_retries: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='UrlRetries',
        raw=nzbget_cfg_url_retries,
        default=3,
        hint='int',
        order=5
        )
      }}"
    _nzbget_cfg_url_interval: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='UrlInterval',
        raw=nzbget_cfg_url_interval,
        default=10,
        hint='int',
        order=6
        )
      }}"
    _nzbget_cfg_url_timeout: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='UrlTimeout',
        raw=nzbget_cfg_url_timeout,
        default=60,
        hint='int',
        order=7
        )
      }}"
    _nzbget_cfg_remote_timeout: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='RemoteTimeout',
        raw=nzbget_cfg_remote_timeout,
        default=90,
        hint='int',
        order=8
        )
      }}"
    _nzbget_cfg_download_rate: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='DownloadRate',
        raw=nzbget_cfg_download_rate,
        default=0,
        hint='int',
        order=9
        )
      }}"
    _nzbget_cfg_url_connections: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='UrlConnections',
        raw=nzbget_cfg_url_connections,
        default=4,
        hint='int',
        order=10
        )
      }}"
    _nzbget_cfg_url_force: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='UrlForce',
        raw=nzbget_cfg_url_force,
        default=true,
        hint='bool',
        order=11
        )
      }}"
    _nzbget_cfg_monthly_quota: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='MonthlyQuota',
        raw=nzbget_cfg_monthly_quota,
        default=0,
        hint='int',
        order=12
        )
      }}"
    _nzbget_cfg_quota_start_day: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='QuotaStartDay',
        raw=nzbget_cfg_quota_start_day,
        default=1,
        hint='int',
        order=13
        )
      }}"
    _nzbget_cfg_daily_quota: "{{ {} | r_pufky.data.v3(
        section='Connection',
        key='DailyQuota',
        raw=nzbget_cfg_daily_quota,
        default=0,
        hint='int',
        order=14
        )
      }}"
    _nzbget_cfg_wite_log: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='WriteLog',
        raw=nzbget_cfg_wite_log,
        default='append',
        hint='str',
        order=1
        )
      }}"
    _nzbget_cfg_rotate_log: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='RotateLog',
        raw=nzbget_cfg_rotate_log,
        default=3,
        hint='int',
        order=2
        )
      }}"
    _nzbget_cfg_error_target: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='ErrorTarget',
        raw=nzbget_cfg_error_target,
        default='both',
        hint='str',
        order=3
        )
      }}"
    _nzbget_cfg_warning_target: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='WarningTarget',
        raw=nzbget_cfg_warning_target,
        default='both',
        hint='str',
        order=4
        )
      }}"
    _nzbget_cfg_info_target: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='InfoTarget',
        raw=nzbget_cfg_info_target,
        default='both',
        hint='str',
        order=5
        )
      }}"
    _nzbget_cfg_detail_target: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='DetailTarget',
        raw=nzbget_cfg_detail_target,
        default='log',
        hint='str',
        order=6
        )
      }}"
    _nzbget_cfg_debug_target: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='DebugTarget',
        raw=nzbget_cfg_debug_target,
        default='log',
        hint='str',
        order=7
        )
      }}"
    _nzbget_cfg_log_buffer: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='LogBuffer',
        raw=nzbget_cfg_log_buffer,
        default=1000,
        hint='int',
        order=8
        )
      }}"
    _nzbget_cfg_nzb_log: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='NzbLog',
        raw=nzbget_cfg_nzb_log,
        default=true,
        hint='bool',
        order=9
        )
      }}"
    _nzbget_cfg_crash_trace: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='CrashTrace',
        raw=nzbget_cfg_crash_trace,
        default=true,
        hint='bool',
        order=10
        )
      }}"
    _nzbget_cfg_crash_dump: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='CrashDump',
        raw=nzbget_cfg_crash_dump,
        default=false,
        hint='bool',
        order=11
        )
      }}"
    _nzbget_cfg_time_correction: "{{ {} | r_pufky.data.v3(
        section='Logging',
        key='TimeCorrection',
        raw=nzbget_cfg_time_correction,
        default=0,
        hint='int',
        order=12
        )
      }}"
    _nzbget_cfg_output_mode: "{{ {} | r_pufky.data.v3(
        section='Display',
        key='OutputMode',
        raw=nzbget_cfg_output_mode,
        default='curses',
        hint='str',
        order=1
        )
      }}"
    _nzbget_cfg_curses_nzb_name: "{{ {} | r_pufky.data.v3(
        section='Display',
        key='CursesNzbName',
        raw=nzbget_cfg_curses_nzb_name,
        default=true,
        hint='bool',
        order=2
        )
      }}"
    _nzbget_cfg_curses_group: "{{ {} | r_pufky.data.v3(
        section='Display',
        key='CursesGroup',
        raw=nzbget_cfg_curses_group,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _nzbget_cfg_curses_time: "{{ {} | r_pufky.data.v3(
        section='Display',
        key='CursesTime',
        raw=nzbget_cfg_curses_time,
        default=false,
        hint='bool',
        order=4
        )
      }}"
    _nzbget_cfg_update_interval: "{{ {} | r_pufky.data.v3(
        section='Display',
        key='UpdateInterval',
        raw=nzbget_cfg_update_interval,
        default=200,
        hint='int',
        order=5
        )
      }}"
    _nzbget_cfg_tasks: "{{ {} | r_pufky.data.v3(
        section='Scheduler',
        key='Task',
        raw=nzbget_cfg_tasks,
        data=[],
        default=[],
        hint='list of dict',
        comment='List of templated dict.',
        order=1
        )
      }}"
    _nzbget_cfg_crc_check: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='CrcCheck',
        raw=nzbget_cfg_crc_check,
        default=true,
        hint='bool',
        order=1
        )
      }}"
    _nzbget_cfg_par_check: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParCheck',
        raw=nzbget_cfg_par_check,
        default='auto',
        hint='str',
        order=2
        )
      }}"
    _nzbget_cfg_par_repair: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParRepair',
        raw=nzbget_cfg_par_repair,
        default=true,
        hint='bool',
        order=3
        )
      }}"
    _nzbget_cfg_par_scan: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParScan',
        raw=nzbget_cfg_par_scan,
        default='extended',
        hint='str',
        order=4
        )
      }}"
    _nzbget_cfg_par_quick: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParQuick',
        raw=nzbget_cfg_par_quick,
        default=true,
        hint='bool',
        order=5
        )
      }}"
    _nzbget_cfg_par_buffer: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParBuffer',
        raw=nzbget_cfg_par_buffer,
        default=100,
        hint='int',
        order=6
        )
      }}"
    _nzbget_cfg_par_threads: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParThreads',
        raw=nzbget_cfg_par_threads,
        default=0,
        hint='int',
        order=7
        )
      }}"
    _nzbget_cfg_par_ignore_ext: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParIgnoreExt',
        raw=nzbget_cfg_par_ignore_ext,
        data=nzbget_cfg_par_ignore_ext | join(','),
        default=['.sfv', '.nzb', '.nfo'],
        hint='list of str',
        order=8
        )
      }}"
    _nzbget_cfg_par_rename: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParRename',
        raw=nzbget_cfg_par_rename,
        default=true,
        hint='bool',
        order=9
        )
      }}"
    _nzbget_cfg_rar_rename: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='RarRename',
        raw=nzbget_cfg_rar_rename,
        default=true,
        hint='bool',
        order=10
        )
      }}"
    _nzbget_cfg_direct_rename: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='DirectRename',
        raw=nzbget_cfg_direct_rename,
        default=true,
        hint='bool',
        order=11
        )
      }}"
    _nzbget_cfg_health_check: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='HealthCheck',
        raw=nzbget_cfg_health_check,
        default='park',
        hint='str',
        order=12
        )
      }}"
    _nzbget_cfg_par_time_limit: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParTimeLimit',
        raw=nzbget_cfg_par_time_limit,
        default=0,
        hint='int',
        order=13
        )
      }}"
    _nzbget_cfg_par_pause_queue: "{{ {} | r_pufky.data.v3(
        section='Check and Repair',
        key='ParPauseQueue',
        raw=nzbget_cfg_par_pause_queue,
        default=false,
        hint='bool',
        order=14
        )
      }}"
    _nzbget_cfg_unpack: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='Unpack',
        raw=nzbget_cfg_unpack,
        default=true,
        hint='bool',
        order=1
        )
      }}"
    _nzbget_cfg_direct_unpack: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='DirectUnpack',
        raw=nzbget_cfg_direct_unpack,
        default=true,
        hint='bool',
        order=2
        )
      }}"
    _nzbget_cfg_unpack_pause_queue: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='UnpackPauseQueue',
        raw=nzbget_cfg_unpack_pause_queue,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _nzbget_cfg_unpack_cleanup_disk: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='UnpackCleanupDisk',
        raw=nzbget_cfg_unpack_cleanup_disk,
        default=true,
        hint='bool',
        order=4
        )
      }}"
    _nzbget_cfg_unrar_cmd: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='UnrarCmd',
        raw=nzbget_cfg_unrar_cmd,
        default='/usr/bin/unrar',
        hint='str',
        order=5
        )
      }}"
    _nzbget_cfg_seven_zip_cmd: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='SevenZipCmd',
        raw=nzbget_cfg_seven_zip_cmd,
        default='/usr/bin/7zz',
        hint='str',
        order=6
        )
      }}"
    _nzbget_cfg_ext_cleanup_disk: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='ExtCleanupDisk',
        raw=nzbget_cfg_ext_cleanup_disk,
        data=nzbget_cfg_ext_cleanup_disk | join(','),
        default=['.par2', '.sfv'],
        hint='list of str',
        order=7
        )
      }}"
    _nzbget_cfg_unpack_ignore_ext: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='UnpackIgnoreExt',
        raw=nzbget_cfg_unpack_ignore_ext,
        data=nzbget_cfg_unpack_ignore_ext | join(','),
        default=['.cbr'],
        hint='list of str',
        order=8
        )
      }}"
    _nzbget_cfg_unpack_pass_file: "{{ {} | r_pufky.data.v3(
        section='Unpack',
        key='UnpackPassFile',
        raw=nzbget_cfg_unpack_pass_file,
        default='',
        hint='str',
        order=9
        )
      }}"
    _nzbget_cfg_extensions: "{{ {} | r_pufky.data.v3(
        section='Extension Scripts',
        key='Extensions',
        raw=nzbget_cfg_extensions,
        data=nzbget_cfg_extensions | join(','),
        default=[],
        hint='list of str',
        order=1
        )
      }}"
    _nzbget_cfg_script_order: "{{ {} | r_pufky.data.v3(
        section='Extension Scripts',
        key='ScriptOrder',
        raw=nzbget_cfg_script_order,
        data=nzbget_cfg_script_order | join(','),
        default=[],
        hint='list of str',
        order=2
        )
      }}"
    _nzbget_cfg_script_pause_queue: "{{ {} | r_pufky.data.v3(
        section='Extension Scripts',
        key='ScriptPauseQueue',
        raw=nzbget_cfg_script_pause_queue,
        default=false,
        hint='bool',
        order=3
        )
      }}"
    _nzbget_cfg_shell_override: "{{ {} | r_pufky.data.v3(
        section='Extension Scripts',
        key='ShellOverride',
        raw=nzbget_cfg_shell_override,
        data='',
        default=[],
        hint='list of dict',
        comment='Str list(;) of lists(,).',
        order=4
        )
      }}"
    _nzbget_cfg_event_interval: "{{ {} | r_pufky.data.v3(
        section='Extension Scripts',
        key='EventInterval',
        raw=nzbget_cfg_event_interval,
        default=0,
        hint='int',
        order=5
        )
      }}"

- name: 'Annotate | merge template nzbget_cfg_news_servers'
  ansible.builtin.set_fact:
    _nzbget_cfg_news_servers: '{{
        _nzbget_cfg_news_servers |
          combine({"data": _nzbget_cfg_news_servers.data | default([]) +
                [nzbget_role_template_news_servers | combine(item)]})
      }}'
  loop: '{{ _nzbget_cfg_news_servers.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template nzbget_cfg_categories'
  ansible.builtin.set_fact:
    _nzbget_cfg_categories: '{{
        _nzbget_cfg_categories |
          combine({"data": _nzbget_cfg_categories.data | default([]) +
                [nzbget_role_template_categories | combine(item)]})
      }}'
  loop: '{{ _nzbget_cfg_categories.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template nzbget_cfg_rss_feeds'
  ansible.builtin.set_fact:
    _nzbget_cfg_rss_feeds: '{{
        _nzbget_cfg_rss_feeds |
          combine({"data": _nzbget_cfg_rss_feeds.data | default([]) +
                [nzbget_role_template_rss_feeds | combine(item)]})
      }}'
  loop: '{{ _nzbget_cfg_rss_feeds.raw }}'
  loop_control:
    label: '{{ item.name }}'

- name: 'Annotate | merge template nzbget_cfg_tasks'
  ansible.builtin.set_fact:
    _nzbget_cfg_tasks: '{{
        _nzbget_cfg_tasks |
          combine({"data": _nzbget_cfg_tasks.data | default([]) +
                [nzbget_role_template_tasks | combine(item)]})
      }}'
  loop: '{{ _nzbget_cfg_tasks.raw }}'
  loop_control:
    label: '{{ item.id }}'

- name: 'Annotate | generate shell override extension map'
  ansible.builtin.set_fact:  # noqa jinja[spacing] prefer 80 char to spacing.
    _nzbget_shell_override: >-
      {% for option in _nzbget_cfg_shell_override.raw | default([]) -%}
      {{- option.ext | list | join(',') }}={{ option.shell }}
      {%- if not loop.last %};{% endif -%}
      {% endfor %}

- name: 'Annotate | update annotations with results'
  ansible.builtin.set_fact:
    _nzbget_cfg_shell_override: '{{
        _nzbget_cfg_shell_override |
          combine({"data": _nzbget_shell_override})
      }}'

- name: 'Annotate | generate config map'
  ansible.builtin.set_fact:
    _nzbget_map: '{{
        hostvars[inventory_hostname] | dict2items |
        selectattr("key", "match", "_nzbget_cfg_*")
      }}'
    _nzbget_order:
      - 'Paths'
      - 'News Servers'
      - 'Security'
      - 'Categories'
      - 'RSS Feeds'
      - 'Incoming NZBs'
      - 'Download Queue'
      - 'Connection'
      - 'Logging'
      - 'Display'
      - 'Scheduler'
      - 'Check and Repair'
      - 'Unpack'
      - 'Extension Scripts'
